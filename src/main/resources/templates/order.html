<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Orders</title>
    <div th:replace="~{/commons/commons :: head}"></div>
</head>

<body>

<div th:replace="~{/commons/commons :: navbar}"></div>
<div th:replace="~{/commons/page-header :: page-header(headerText='Orders')}"></div>

<div class="container-xxl py-6">
    <div class="container">
        <div class="section-header text-center mx-auto mb-5">
            <h1 class="display-5 mb-3">Orders</h1>
            <h3 th:if="${message != null}" th:text="${message}" class="text-center"></h3>
        </div>

        <div class="row">
<!--             th:if="${#request.isUserInRole('ADMIN') or #request.isUserInRole('MANAGER')}"-->

            <div class="col-12">
                <ul class="nav nav-pills mb-3" id="ordersTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="created-tab" data-bs-toggle="pill" href="#CREATED" role="tab" aria-controls="created" aria-selected="true">Created</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="inProgress-tab" data-bs-toggle="pill" href="#IN_PROGRES" role="tab" aria-controls="inProgress" aria-selected="false">In Progress</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="done-tab" data-bs-toggle="pill" href="#DONE" role="tab" aria-controls="done" aria-selected="false">Done</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="closed-tab" data-bs-toggle="pill" href="#CLOSED" role="tab" aria-controls="closed" aria-selected="false">Closed</a>
                    </li>
                </ul>
                <div class="tab-content" id="ordersTabContent">
                    <div th:each="status : ${T(com.hescha.healthystore.model.OrderStatus).values()}"
                         th:id="${status}"
                         th:classappend="${status == T(com.hescha.healthystore.model.OrderStatus).CREATED} ? 'active show'"
                         class="tab-pane fade" role="tabpanel" aria-labelledby="${status}-tab">
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Created</th>
                                <th>Status</th>
                                <th>Order Items</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="order : ${list}" th:if="${order.status == status}">
                                <td th:text="${order.id}"></td>
                                <td th:text="${order.created}"></td>
                                <td th:text="${order.status}"></td>
                                <td>
                                    <ul>
                                        <li th:each="item : ${order.orderitems}" th:if="${order.status == T(com.hescha.healthystore.model.OrderStatus).CREATED}">
                                            <span th:text="${item.product.name}"></span> x <span th:text="${item.count}"></span>
                                            <span> = </span>
                                            <span th:text="${item.product.price * item.count}">Partial cost</span>
                                            <a class="btn btn-danger btn-sm" th:href="@{/order/{id}/deleteOrderItem/{itemId}(id=${order.id}, itemId=${item.id})}">Delete</a>
                                        </li>
                                        <li>
                                            <span colspan="3">Total cost:</span>
                                            <span th:text="${order.getPrice()}"></span>
                                        </li>
                                    </ul>
                                </td>
                                <td>
                                    <a th:if="${status == T(com.hescha.healthystore.model.OrderStatus).CREATED}"
                                       class="btn btn-danger"
                                       th:href="@{/order/{id}/delete(id=${order.id})}">Delete Order</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{/commons/commons :: footer}"></div>

</body>

</html>

